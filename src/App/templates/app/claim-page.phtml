<?php $this->layout('layout::default', ['title' => 'Claim']);

/**
 * @var \Opg\Refunds\Caseworker\DataModel\Cases\Claim $claim
 * @var \App\Form\AbstractForm $form
 */

$this->addErrorMap([
    'message' => [
        'required' => [
            'summary'   => 'Please enter a user log message',
            'field'     => 'Enter a user log message'
        ]
    ]
]);
?>

<h2 class="heading-large"><?= $claim->getReferenceNumber() ?> <?= $claim->getDonorName() ?></h2>

<?php $this->insert('snippet::error-summary', [ 'form'=>$form ]) ?>

<h2 class="heading-medium">User log</h2>

<form method="post" class="form">

    <?php $this->insert('snippet::form-csrf', ['form' => $form]) ?>

    <fieldset>

        <?php $this->insert('snippet::input-text', [
            'formElement' => $form->get('message'),
            'formLabel' => 'Add a user log',
            'formType' => 'textarea',
            'formLabelBold' => false
        ]) ?>

    </fieldset>

    <div class="form-group">
        <input type="submit" class="button" value="Submit log" />
    </div>

</form>

<?php foreach ($claim->getLogs() as $log) { ?>
    <?php /** @var \Opg\Refunds\Caseworker\DataModel\Cases\Log $log */ ?>
    <div>
        <h3 class="heading-small"><?= $this->getLogDateString($log->getCreatedDateTime()) ?> <?= $this->getLogTimeString($log->getCreatedDateTime()) ?></h3>
        <h4 class="heading-small"><?= $log->getTitle() ?></h4>
        <p><?= $log->getMessage() ?></p>
        <?php if ($log->getUserName() !== null) { ?>
            <p>by <?= $log->getUserName() ?></p>
        <?php } ?>
    </div>
<?php } ?>

<p><a href="/">Back to home page</a></p>
